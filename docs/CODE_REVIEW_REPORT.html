<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTC Arena Sheets DataCenter ‚Äî Code Review Report</title>
  <style>
    :root {
      --critical: #dc2626;
      --high:     #ea580c;
      --medium:   #ca8a04;
      --low:      #2563eb;
      --ok:       #16a34a;
      --bg:       #f8fafc;
      --card:     #ffffff;
      --border:   #e2e8f0;
      --text:     #1e293b;
      --muted:    #64748b;
      --header-bg:#1e293b;
      --tab-active:#3b82f6;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); font-size: 14px; line-height: 1.6; }

    /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
    .report-header { background: var(--header-bg); color: #fff; padding: 36px 48px; }
    .report-header h1 { font-size: 26px; font-weight: 700; margin-bottom: 6px; }
    .report-header .subtitle { color: #94a3b8; font-size: 14px; }
    .report-header .meta { margin-top: 18px; display: flex; gap: 32px; flex-wrap: wrap; }
    .report-header .meta-item { font-size: 13px; }
    .report-header .meta-item span { color: #94a3b8; display: block; font-size: 11px; text-transform: uppercase; letter-spacing: .06em; }

    /* ‚îÄ‚îÄ EXEC SUMMARY ‚îÄ‚îÄ */
    .exec-summary { padding: 32px 48px; background: #fff; border-bottom: 1px solid var(--border); }
    .exec-summary h2 { font-size: 18px; margin-bottom: 20px; }
    .scorecard { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .score-card { border-radius: 10px; padding: 20px 16px; text-align: center; border: 1px solid var(--border); }
    .score-card .count { font-size: 36px; font-weight: 800; line-height: 1; margin-bottom: 4px; }
    .score-card .label { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; }
    .score-card.critical { border-color: var(--critical); background: #fef2f2; }
    .score-card.critical .count { color: var(--critical); }
    .score-card.high     { border-color: var(--high);     background: #fff7ed; }
    .score-card.high .count     { color: var(--high); }
    .score-card.medium   { border-color: var(--medium);   background: #fefce8; }
    .score-card.medium .count   { color: var(--medium); }
    .score-card.low      { border-color: var(--low);      background: #eff6ff; }
    .score-card.low .count      { color: var(--low); }
    .score-card.total    { border-color: #6366f1;         background: #eef2ff; }
    .score-card.total .count    { color: #6366f1; }

    .exec-prose { color: var(--muted); max-width: 860px; line-height: 1.7; }
    .exec-prose p { margin-bottom: 10px; }
    .exec-pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
    .exec-box { border-radius: 8px; padding: 16px 20px; }
    .exec-box.good  { background: #f0fdf4; border: 1px solid #86efac; }
    .exec-box.needs { background: #fff7ed; border: 1px solid #fed7aa; }
    .exec-box h4 { font-size: 13px; font-weight: 700; margin-bottom: 10px; text-transform: uppercase; letter-spacing: .05em; }
    .exec-box.good h4 { color: var(--ok); }
    .exec-box.needs h4 { color: var(--high); }
    .exec-box ul { padding-left: 16px; }
    .exec-box li { margin-bottom: 6px; font-size: 13px; }

    /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
    .tabs-container { padding: 0 48px; background: #fff; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
    .tabs { display: flex; gap: 0; overflow-x: auto; }
    .tab-btn { padding: 14px 20px; font-size: 13px; font-weight: 600; cursor: pointer; background: none; border: none; border-bottom: 3px solid transparent; color: var(--muted); white-space: nowrap; transition: all .2s; }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active { color: var(--tab-active); border-bottom-color: var(--tab-active); }
    .tab-btn .badge { display: inline-block; background: #e2e8f0; color: var(--muted); border-radius: 20px; padding: 1px 8px; font-size: 11px; margin-left: 6px; }
    .tab-btn.active .badge { background: #dbeafe; color: var(--tab-active); }

    /* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
    .content { padding: 32px 48px; max-width: 1400px; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .section-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; }
    .section-desc { color: var(--muted); margin-bottom: 24px; }

    /* ‚îÄ‚îÄ FINDING CARDS ‚îÄ‚îÄ */
    .finding { background: var(--card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 16px; overflow: hidden; }
    .finding-header { display: flex; align-items: flex-start; gap: 12px; padding: 16px 20px; cursor: pointer; user-select: none; }
    .finding-header:hover { background: #f8fafc; }
    .finding-header .arrow { color: var(--muted); font-size: 12px; margin-left: auto; flex-shrink: 0; transition: transform .2s; }
    .finding.open .arrow { transform: rotate(90deg); }
    .finding-body { display: none; padding: 0 20px 20px; border-top: 1px solid var(--border); }
    .finding.open .finding-body { display: block; }
    .finding-title { font-weight: 600; font-size: 14px; flex: 1; }
    .finding-meta { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px; align-items: center; }
    .tag { display: inline-block; border-radius: 4px; padding: 2px 8px; font-size: 11px; font-weight: 600; }
    .tag.sev-critical { background: var(--critical); color: #fff; }
    .tag.sev-high     { background: var(--high);     color: #fff; }
    .tag.sev-medium   { background: var(--medium);   color: #fff; }
    .tag.sev-low      { background: var(--low);       color: #fff; }
    .tag.sev-info     { background: #64748b;          color: #fff; }
    .tag.cat          { background: #f1f5f9; color: var(--muted); border: 1px solid var(--border); }
    .tag.file         { background: #eff6ff; color: #3b82f6; border: 1px solid #bfdbfe; font-family: monospace; }

    .finding-body h4 { font-size: 13px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; margin: 16px 0 6px; }
    .finding-body p { color: var(--text); margin-bottom: 8px; font-size: 13px; line-height: 1.65; }
    pre { background: #1e293b; color: #e2e8f0; border-radius: 8px; padding: 16px; font-size: 12px; overflow-x: auto; margin: 8px 0; font-family: 'Fira Code', 'Cascadia Code', 'Consolas', monospace; line-height: 1.6; }
    code { background: #f1f5f9; padding: 2px 5px; border-radius: 3px; font-family: monospace; font-size: 12px; }
    .rec-box { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 12px 16px; margin-top: 10px; font-size: 13px; }
    .rec-box strong { color: var(--ok); }

    /* ‚îÄ‚îÄ FILTER BAR ‚îÄ‚îÄ */
    .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
    .filter-bar label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; }
    .filter-btn { padding: 5px 12px; border-radius: 20px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: 12px; font-weight: 600; color: var(--muted); transition: all .2s; }
    .filter-btn:hover, .filter-btn.active { color: #fff; border-color: transparent; }
    .filter-btn.f-critical.active { background: var(--critical); }
    .filter-btn.f-high.active     { background: var(--high); }
    .filter-btn.f-medium.active   { background: var(--medium); }
    .filter-btn.f-low.active      { background: var(--low); }
    .filter-btn.f-all.active      { background: #6366f1; }

    /* ‚îÄ‚îÄ PERF TIMELINE ‚îÄ‚îÄ */
    .perf-timeline { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 24px; }
    .perf-timeline h3 { font-size: 15px; font-weight: 700; margin-bottom: 16px; }
    .timeline-steps { display: flex; flex-direction: column; gap: 0; }
    .t-step { display: flex; gap: 16px; align-items: stretch; }
    .t-connector { display: flex; flex-direction: column; align-items: center; gap: 0; }
    .t-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; margin-top: 4px; }
    .t-line { width: 2px; background: #e2e8f0; flex: 1; min-height: 16px; }
    .t-content { padding-bottom: 16px; flex: 1; }
    .t-content .t-label { font-weight: 600; font-size: 13px; }
    .t-content .t-detail { color: var(--muted); font-size: 12px; margin-top: 2px; }
    .t-content .t-time { display: inline-block; background: #fef2f2; color: var(--critical); border-radius: 4px; padding: 2px 8px; font-size: 11px; font-weight: 700; margin-top: 4px; }
    .t-content .t-ok { display: inline-block; background: #f0fdf4; color: var(--ok); border-radius: 4px; padding: 2px 8px; font-size: 11px; font-weight: 700; margin-top: 4px; }

    /* ‚îÄ‚îÄ IMPROVEMENTS COMPARISON ‚îÄ‚îÄ */
    .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
    .compare-card { border-radius: 10px; padding: 20px; }
    .compare-card.before { background: #fef2f2; border: 1px solid #fecaca; }
    .compare-card.after  { background: #f0fdf4; border: 1px solid #86efac; }
    .compare-card h4 { font-size: 13px; font-weight: 700; margin-bottom: 12px; text-transform: uppercase; letter-spacing: .05em; }
    .compare-card.before h4 { color: var(--critical); }
    .compare-card.after h4  { color: var(--ok); }
    .compare-card .stat { font-size: 28px; font-weight: 800; }
    .compare-card.before .stat { color: var(--critical); }
    .compare-card.after .stat  { color: var(--ok); }

    /* ‚îÄ‚îÄ PRIORITY ROADMAP ‚îÄ‚îÄ */
    .roadmap { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 24px; margin-top: 24px; }
    .roadmap h3 { font-size: 16px; font-weight: 700; margin-bottom: 20px; }
    .roadmap-phases { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
    .phase { border-radius: 8px; padding: 16px; }
    .phase.p1 { background: #fef2f2; border: 1px solid #fecaca; }
    .phase.p2 { background: #fff7ed; border: 1px solid #fed7aa; }
    .phase.p3 { background: #f0fdf4; border: 1px solid #86efac; }
    .phase h4 { font-size: 13px; font-weight: 700; margin-bottom: 10px; }
    .phase.p1 h4 { color: var(--critical); }
    .phase.p2 h4 { color: var(--high); }
    .phase.p3 h4 { color: var(--ok); }
    .phase ul { padding-left: 16px; }
    .phase li { font-size: 12px; margin-bottom: 6px; color: var(--text); }

    /* FOOTER */
    .report-footer { margin: 40px 0 0; padding: 24px 48px; background: var(--header-bg); color: #94a3b8; font-size: 12px; }

    @media (max-width: 700px) {
      .report-header, .exec-summary, .tabs-container, .content, .report-footer { padding-left: 16px; padding-right: 16px; }
      .exec-pros-cons, .comparison { grid-template-columns: 1fr; }
      .scorecard { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="report-header">
  <h1>PTC Arena Sheets DataCenter ‚Äî Code Review Report</h1>
  <div class="subtitle">Comprehensive multi-agent security, performance, quality &amp; API compliance audit</div>
  <div class="meta">
    <div class="meta-item"><span>Date</span>February 25, 2026</div>
    <div class="meta-item"><span>Codebase</span>24 source files ¬∑ ~16,600 lines</div>
    <div class="meta-item"><span>Reviewed By</span>4-agent automated review team</div>
    <div class="meta-item"><span>Agents</span>Security ¬∑ Performance ¬∑ Code Quality ¬∑ Arena API/UX</div>
    <div class="meta-item"><span>Phase 1 Status</span>‚úÖ Applied 2026-02-25 ‚Äî 10 fixes (A1‚ÄìA5, B1‚ÄìB3, C1‚ÄìC3)</div>
    <div class="meta-item"><span>Phase 2 Status</span>‚úÖ Applied 2026-02-25 ‚Äî 7 fixes (A1‚ÄìA3, B1‚ÄìB2, C1‚ÄìC2)</div>
    <div class="meta-item"><span>Phase 3 Status</span>‚úÖ Applied 2026-02-25 ‚Äî 18 fixes (A1‚ÄìA4, B1‚ÄìB4, C1‚ÄìC2, D1‚ÄìD8, E1‚ÄìE2)</div>
    <div class="meta-item"><span>Final Fixes</span>‚úÖ Applied 2026-02-25 ‚Äî critical PROPERTY_KEYS fix, full singleton sweep (28 sites), QA-05, UX-05, API-03/04, PERF-09</div>
    <div class="meta-item"><span>Remediation</span>~42 of 65 findings fixed ¬∑ 6 deferred by design ¬∑ See REMEDIATION_LOG.md</div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXEC SUMMARY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="exec-summary">
  <h2>Executive Summary</h2>

  <div class="scorecard">
    <div class="score-card critical"><div class="count">2</div><div class="label">Critical</div></div>
    <div class="score-card high">    <div class="count">12</div><div class="label">High</div></div>
    <div class="score-card medium">  <div class="count">22</div><div class="label">Medium</div></div>
    <div class="score-card low">     <div class="count">29</div><div class="label">Low</div></div>
    <div class="score-card total">   <div class="count">65</div><div class="label">Total Findings</div></div>
  </div>
  <div class="scorecard" style="margin-top:16px;">
    <div class="score-card" style="border-color:#16a34a;background:#f0fdf4;"><div class="count" style="color:#16a34a;">~42</div><div class="label">Fixed</div></div>
    <div class="score-card" style="border-color:#ca8a04;background:#fefce8;"><div class="count" style="color:#ca8a04;">6</div><div class="label">Deferred</div></div>
    <div class="score-card" style="border-color:#6366f1;background:#eef2ff;"><div class="count" style="color:#6366f1;">3+</div><div class="label">Phases Complete</div></div>
    <div class="score-card" style="border-color:#2563eb;background:#eff6ff;"><div class="count" style="color:#2563eb;">~55</div><div class="label">Fixes Applied</div></div>
  </div>
  <p style="color:#64748b;font-size:12px;margin-top:10px;">Full fix history: <code>docs/REMEDIATION_LOG.md</code> ¬∑ Last updated: 2026-02-25</p>

  <div class="exec-prose">
    <p>The PTC Arena Sheets DataCenter is a well-structured Google Apps Script integration with Arena PLM. No critical security vulnerabilities were found ‚Äî credentials are properly stored in PropertiesService, authentication flows are solid, and CSRF is handled by the platform. However, <strong>two critical architectural issues</strong> were identified in Arena API integration design, and a <strong>significant performance bottleneck</strong> exists in rack template loading that can be reduced by 75‚Äì80%.</p>
    <p>The largest opportunity areas are: eliminating N+1 API call patterns that cause slow template loads, standardising error handling across the codebase, centralising ~30 hardcoded values into Config.gs, and adding proper rate-limit handling and pagination for list endpoints.</p>
  </div>

  <div class="exec-pros-cons">
    <div class="exec-box good">
      <h4>‚úì What's Working Well</h4>
      <ul>
        <li>API credentials stored securely in PropertiesService</li>
        <li>Session caching with 6-hour TTL is excellent</li>
        <li>Auto re-authentication on 401 expiry</li>
        <li>CacheService item cache already built (just not fully utilised)</li>
        <li>Batch sheet writes in clone operations (setValues/setBackgrounds)</li>
        <li>CSRF protection via HtmlService is correct</li>
        <li>History logging is well-structured</li>
        <li>Config.gs centralises most constants (needs extension)</li>
      </ul>
    </div>
    <div class="exec-box needs">
      <h4>‚ö† Remaining / Deferred</h4>
      <ul>
        <li><strong>API-01:</strong> DomainApi layer missing per Arena architecture guidance ‚Äî deferred (major refactor)</li>
        <li><strong>SEC-02:</strong> Password in PropertiesService ‚Äî accepted (correct GAS pattern, no better option)</li>
        <li><strong>QA-03/05/06:</strong> HTML string building, onOpen() size, duplicate extraction ‚Äî deferred refactors</li>
        <li><strong>API-03/04:</strong> Metadata-first validation, response normalisation ‚Äî deferred to API layer sprint</li>
        <li><strong>UX-01/05/06/07:</strong> Loading spinners, modal help text, keyboard nav ‚Äî frontend work</li>
        <li><strong>PERF-09/10:</strong> getActiveSpreadsheet() calls, progress feedback ‚Äî low priority</li>
      </ul>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="tabs-container">
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('security')">üîí Security<span class="badge">12</span></button>
    <button class="tab-btn" onclick="switchTab('performance')">‚ö° Performance<span class="badge">11</span></button>
    <button class="tab-btn" onclick="switchTab('quality')">üîß Code Quality<span class="badge">26</span></button>
    <button class="tab-btn" onclick="switchTab('arena')">üîó Arena API / UX<span class="badge">19</span></button>
    <button class="tab-btn" onclick="switchTab('roadmap')">üó∫ Roadmap</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="content">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SECURITY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-security" class="tab-panel active">
  <div class="section-title">Security Audit</div>
  <div class="section-desc">Reviewed: Authorization.gs, ArenaAPI.gs, Config.gs, Code.gs, SetupWizard_Backend.gs, LoginWizard.html, SetupWizard.html, RackPicker.html, ItemPicker.html, BOMTreeModal.html</div>

  <div class="filter-bar">
    <label>Filter:</label>
    <button class="filter-btn f-all active" onclick="filterFindings('security','all',this)">All</button>
    <button class="filter-btn f-medium" onclick="filterFindings('security','medium',this)">Medium</button>
    <button class="filter-btn f-low"    onclick="filterFindings('security','low',this)">Low</button>
  </div>

  <!-- SEC-1 -->
  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-01 ¬∑ Sensitive data in error logs</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Logging / Data Exposure</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 64, 69, 114‚Äì116, 267‚Äì269</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Error responses are logged verbatim via <code>Logger.log()</code>. If log exports occur, Arena API response bodies, field names, GUIDs, and partial item data may be exposed.</p>
      <pre>Logger.log('Making request to: ' + url);         // line 64
Logger.log('Response code: ' + responseCode);   // line 69
Logger.log('API Error - Response: ' + responseText); // line 116
Logger.log('Setting attribute ' + guid + ' to ' + value); // line 267</pre>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Log only HTTP status codes in production paths. Gate full response logging behind a <code>DEBUG_MODE</code> flag stored in script properties.</div>
      <pre>// In makeRequest error branch:
Logger.log('API error: HTTP ' + responseCode + ' on ' + endpoint);
if (getDebugMode()) Logger.log('DEBUG body: ' + responseText.substring(0, 300));</pre>
    </div>
  </div>

  <!-- SEC-2 -->
  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-02 ¬∑ Plaintext password in PropertiesService</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Credential Design</span>
          <span class="tag file">Authorization.gs</span>
          <span class="tag file">Lines 24‚Äì56, 79‚Äì81</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>User Arena passwords are stored in plaintext in Google PropertiesService, which is the only practical option in Apps Script. However, there is no documentation warning users about risk, no service-account recommendation, and no credential-rotation reminder.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> (1) Add a security notice in the Setup Wizard UI reminding users to use a limited-privilege Arena account. (2) Check whether Arena supports OAuth2/SAML for a passwordless flow. (3) Add a "Session account" recommendation (dedicated read/write Arena user, not admin) in the docs.</div>
    </div>
  </div>

  <!-- SEC-3 -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-03 ¬∑ HTML injection in showProgressDialog</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">XSS / Injection</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Lines 353‚Äì357</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The <code>message</code> parameter is injected directly into an HTML string without escaping. While currently only called with developer-controlled strings, this is fragile.</p>
      <pre>var html = '&lt;p&gt;' + message.replace(/\n/g, '&lt;br&gt;') + '&lt;/p&gt;';</pre>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Escape the message before injecting into HTML.</div>
      <pre>var safeMsg = message.replace(/&amp;/g,'&amp;amp;').replace(/&lt;/g,'&amp;lt;')
                      .replace(/&gt;/g,'&amp;gt;').replace(/\n/g,'&lt;br&gt;');
var html = '&lt;p&gt;' + safeMsg + '&lt;/p&gt;';</pre>
    </div>
  </div>

  <!-- SEC-4 -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-04 ¬∑ No itemId format validation before API calls</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Input Validation</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 205‚Äì207, 235, 265</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>getItem()</code>, <code>updateItem()</code>, and <code>setItemAttribute()</code> use <code>encodeURIComponent(itemId)</code> but never validate that itemId is a non-empty string before constructing the request URL. Empty or null IDs produce wasted API calls.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add a guard at the top of each method.</div>
      <pre>if (!itemId || typeof itemId !== 'string' || !itemId.trim()) {
  throw new Error('getItem: itemId must be a non-empty string');
}</pre>
    </div>
  </div>

  <!-- SEC-5 -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-05 ¬∑ No retry limit on 401 session re-login</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Session Management</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 71‚Äì84</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>When a 401 is received, the code clears the session and immediately calls <code>getValidSessionId()</code>. If login succeeds but the next request also returns 401, there is no guard preventing an infinite retry loop in edge cases.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Track retry state and cap at one automatic re-login attempt.</div>
      <pre>if (responseCode === 401 &amp;&amp; !this._retryAttempted) {
  this._retryAttempted = true;
  clearSession();
  this.sessionId = getValidSessionId();
  // retry request once
} else if (responseCode === 401) {
  throw new Error('Session re-login failed. Please re-authenticate.');
}</pre>
    </div>
  </div>

  <!-- SEC-6 -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-06 ¬∑ No rate-limit (429) response handling</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">API Rate Limiting</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Line 589</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The only throttle protection is a fixed 200ms sleep between paginated batch requests. If Arena returns HTTP 429 (Too Many Requests), the code does not detect or handle it ‚Äî it will throw a generic error and fail silently.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add explicit 429 handling with backoff in <code>makeRequest()</code>.</div>
      <pre>if (responseCode === 429) {
  var retryAfter = parseInt(response.getHeaders()['Retry-After'] || '10', 10);
  Logger.log('Rate limited. Waiting ' + retryAfter + 's before retry.');
  Utilities.sleep(retryAfter * 1000);
  // retry request
}</pre>
    </div>
  </div>

  <!-- SEC-7 -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-07 ¬∑ Cache parse errors not handled</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Cache Integrity</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 342‚Äì378</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The cached JSON retrieved from <code>CacheService</code> is parsed with <code>JSON.parse()</code> but not wrapped in a try/catch. Cache corruption would throw an unhandled exception and crash the caller.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Wrap JSON.parse in a try/catch and fall back to a cache refresh on parse errors.</div>
      <pre>try {
  itemCache = JSON.parse(cachedJson);
  if (typeof itemCache !== 'object') throw new Error('bad cache shape');
} catch(e) {
  Logger.log('Cache corrupted, refreshing: ' + e.message);
  cache.remove(ITEM_CACHE_KEY);
  itemCache = this.refreshItemCache();
}</pre>
    </div>
  </div>

  <!-- SEC-8: Search param validation -->
  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC-08 ¬∑ Search/filter query parameters not validated</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Input Validation</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 183‚Äì184, 319</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Category filter and search query strings are passed through <code>encodeURIComponent()</code> but are not length-checked. Extremely long strings could cause unexpected API behavior.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Validate string types and impose length limits (255 chars for category, 500 for query).</div>
    </div>
  </div>

  <!-- SEC Positive findings -->
  <div class="finding" data-sev="info" style="border-left: 4px solid var(--ok);">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">SEC ‚úì ¬∑ Confirmed good practices (no action needed)</div>
        <div class="finding-meta">
          <span class="tag sev-info">Info</span>
          <span class="tag cat">Positive Findings</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <ul style="padding-left:16px; margin-top:10px;">
        <li style="margin-bottom:6px;">‚úì No hardcoded credentials ‚Äî all stored in PropertiesService</li>
        <li style="margin-bottom:6px;">‚úì Session token never returned to the UI or exposed in HTTP responses</li>
        <li style="margin-bottom:6px;">‚úì LoginWizard.html uses <code>textContent</code> for all dynamic display (no innerHTML injection)</li>
        <li style="margin-bottom:6px;">‚úì CSRF protection handled automatically by Google Apps Script HtmlService</li>
        <li style="margin-bottom:6px;">‚úì Email regex validation present in LoginWizard</li>
        <li style="margin-bottom:6px;">‚úì Password field never echoed back in authorization status responses</li>
      </ul>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PERFORMANCE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-performance" class="tab-panel">
  <div class="section-title">Performance Analysis</div>
  <div class="section-desc">Root cause of slow Rack template loading traced. Estimated improvement: <strong>75‚Äì80% reduction in load time</strong> (10‚Äì13s ‚Üí 2‚Äì3s).</div>

  <!-- comparison cards -->
  <div class="comparison">
    <div class="compare-card before">
      <h4>Current ‚Äî Template Load</h4>
      <div class="stat">10‚Äì13 s</div>
      <p style="font-size:12px;margin-top:8px;color:#64748b;">50‚Äì100 sequential API calls for a 50-component rack (one call per BOM line)</p>
    </div>
    <div class="compare-card after">
      <h4>After Fixes ‚Äî Template Load</h4>
      <div class="stat">2‚Äì3 s</div>
      <p style="font-size:12px;margin-top:8px;color:#64748b;">1‚Äì2 API calls using shared cache, single bulk operations, and batched sheet writes</p>
    </div>
  </div>

  <!-- root cause timeline -->
  <div class="perf-timeline">
    <h3>‚è± Rack Template Load ‚Äî Step-by-Step Trace</h3>
    <div class="timeline-steps">
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#6366f1"></div><div class="t-line"></div></div>
        <div class="t-content"><div class="t-label">1. User selects rack item in RackPicker</div><div class="t-detail">RackCloneManager.gs ‚Üí <code>loadArenaTemplate()</code> called</div><span class="t-ok">Fast</span></div>
      </div>
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#6366f1"></div><div class="t-line"></div></div>
        <div class="t-content"><div class="t-label">2. getItemByNumber() ‚Äî 1 API call</div><div class="t-detail">ArenaAPI.gs ‚Üí looks up root item. Uses cache if warm. <code>line 296</code></div><span class="t-ok">~200ms</span></div>
      </div>
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#ea580c"></div><div class="t-line"></div></div>
        <div class="t-content"><div class="t-label">3. BOM fetch ‚Äî 1 API call</div><div class="t-detail">makeRequest('/items/GUID/bom') returns list of ~50 BOM lines. <code>line 314</code></div><span class="t-time">~800ms</span></div>
      </div>
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#dc2626"></div><div class="t-line"></div></div>
        <div class="t-content"><div class="t-label">4. ‚ö† N+1: Per-line item detail fetch loop</div><div class="t-detail">BOMRefresh.gs lines 68‚Äì85: <code>arenaBOM.forEach(line =&gt; arenaClient.makeRequest('/items/'+GUID))</code> ‚Äî 1 API call PER BOM component. 50 components = 50 sequential calls</div><span class="t-time">‚ö† 50 √ó ~200ms = ~10,000ms</span></div>
      </div>
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#dc2626"></div><div class="t-line"></div></div>
        <div class="t-content"><div class="t-label">5. ‚ö† Row-by-row sheet formatting</div><div class="t-detail">RackPopulator.gs lines 216‚Äì228: individual <code>getRange(i+2,...).setBackground()</code> and <code>setFontColor()</code> calls per row instead of bulk arrays</div><span class="t-time">‚ö† N √ó sheet API calls</span></div>
      </div>
      <div class="t-step">
        <div class="t-connector"><div class="t-dot" style="background:#6366f1"></div></div>
        <div class="t-content"><div class="t-label">6. Sheet written, dialog closed</div><div class="t-detail">Template display complete</div><span class="t-ok">Fast</span></div>
      </div>
    </div>
  </div>

  <!-- PERF findings -->

  <div class="finding" data-sev="critical">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-01 ¬∑ N+1 API calls per BOM component on template load</div>
        <div class="finding-meta">
          <span class="tag sev-critical">Critical</span>
          <span class="tag cat">N+1 Pattern</span>
          <span class="tag file">BOMRefresh.gs</span>
          <span class="tag file">Lines 68‚Äì95</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Inside <code>compareBOMs()</code>, every BOM line triggers an individual HTTP request to Arena to fetch full item details. For a rack with 50 components this creates 50 sequential API calls, each taking ~200ms = <strong>10 seconds of pure API wait time</strong>.</p>
      <pre>// BOMRefresh.gs line 68 ‚Äì the culprit loop
arenaBOM.forEach(function(line) {
  var itemNumber = line.item &amp;&amp; line.item.number;
  var itemGuid   = line.item &amp;&amp; line.item.guid;
  try {
    fullItem = arenaClient.makeRequest('/items/' + itemGuid, { method: 'GET' }); // ‚Üê called per line!
  } catch(e) {
    fullItem = arenaClient.getItemByNumber(itemNumber); // ‚Üê fallback also per line
  }
});</pre>
      <h4>Root Cause</h4>
      <p>The shared <code>ITEM_CACHE_KEY</code> cache in ArenaAPI.gs already stores all items. BOMRefresh.gs does not use <code>getItemByNumber()</code> (which hits cache) but instead calls <code>makeRequest('/items/GUID')</code> directly ‚Äî bypassing the cache entirely.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Batch-populate the cache ONCE before the loop, then read from cache inside the loop.</div>
      <pre>// Step 1: Ensure cache is warm (one call if not already loaded)
if (!arenaClient.isItemCacheWarm()) {
  arenaClient.refreshItemCache(); // fetches all items in paginated batches
}

// Step 2: Read from cache ‚Äî no HTTP calls per line
arenaBOM.forEach(function(line) {
  var itemNumber = line.item &amp;&amp; line.item.number;
  var fullItem   = arenaClient.getItemByNumber(itemNumber); // cache hit
  // proceed with comparison
});</pre>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-02 ¬∑ Row-by-row color formatting in RackPopulator</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Spreadsheet Thrashing</span>
          <span class="tag file">RackPopulator.gs</span>
          <span class="tag file">Lines 210‚Äì228</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Category color application loops over each row and makes 2‚Äì3 individual sheet API calls per row (<code>getRange</code>, <code>setBackground</code>, <code>setFontColor</code>). For 50 rows this is 150+ sheet operations.</p>
      <pre>// Lines 216-228: O(N) sheet API calls
for (var i = 0; i &lt; categories.length; i++) {
  var rowRange = sheet.getRange(i + 2, 1, 1, 4);  // ‚Üê individual getRange
  if (color) {
    rowRange.setBackground(color);   // ‚Üê individual call
    rowRange.setFontColor('#FFF');   // ‚Üê individual call
  }
}</pre>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Build color arrays, then apply with a single bulk call ‚Äî same pattern already used correctly in <code>RackCloneManager.gs line 516</code>.</div>
      <pre>var backgrounds = [], fontColors = [];
for (var i = 0; i &lt; categories.length; i++) {
  var color = getCategoryColor(categories[i][0]);
  backgrounds.push([color || '#ffffff']);
  fontColors.push([color ? '#ffffff' : '#000000']);
}
var range = sheet.getRange(2, 1, categories.length, 4);
range.setBackgrounds(backgrounds.map(r =&gt; [r[0],r[0],r[0],r[0]]));
range.setFontColors(fontColors.map(r =&gt; [r[0],r[0],r[0],r[0]]));</pre>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-03 ¬∑ Multiple individual metadata getRange calls in RackConfigManager</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Spreadsheet Thrashing</span>
          <span class="tag file">RackConfigManager.gs</span>
          <span class="tag file">Lines 167‚Äì177, 527‚Äì529</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Metadata writes to the rack sheet (PARENT_ITEM label, item number, name, description) are done as 4 individual <code>setValue()</code> calls followed by separate <code>setBackground()</code> and <code>setFontColor()</code> calls. This pattern appears in at least 3 locations.</p>
      <pre>// Lines 167-177 ‚Äî 6 separate sheet operations
newSheet.getRange(METADATA_ROW, META_LABEL_COL).setValue('PARENT_ITEM');
newSheet.getRange(METADATA_ROW, META_ITEM_NUM_COL).setValue(rackItemNumber);
newSheet.getRange(METADATA_ROW, META_ITEM_NAME_COL).setValue(rackItemName);
newSheet.getRange(METADATA_ROW, META_ITEM_DESC_COL).setValue(rackItemDescription || '');
var metaRange = newSheet.getRange(METADATA_ROW, 1, 1, 4);
metaRange.setBackground('#e8f0fe');
metaRange.setFontColor('#1967d2');</pre>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Use <code>setValues([[...]])</code> to write all metadata cells in one operation.</div>
      <pre>var metaRange = newSheet.getRange(METADATA_ROW, 1, 1, 4);
metaRange.setValues([['PARENT_ITEM', rackItemNumber, rackItemName, rackItemDescription || '']]);
metaRange.setBackground('#e8f0fe');
metaRange.setFontColor('#1967d2');</pre>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-04 ¬∑ Multiple new ArenaAPIClient() instances per workflow</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Redundant Auth / Session Overhead</span>
          <span class="tag file">BOMBuilder.gs</span>
          <span class="tag file">Lines 57‚Äì60, 228 ¬∑ BOMRefresh.gs L96 ¬∑ RackConfigManager.gs L84</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Each major function creates its own <code>new ArenaAPIClient()</code> instance. While session IDs are cached in CacheService, each instantiation still calls <code>getValidSessionId()</code> which reads from cache. More critically, if a session has expired, each instance triggers an independent re-login, potentially causing race conditions and unnecessary login API calls.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Create a single shared client per workflow and pass it through the call chain. For independent operations, this reduces auth overhead significantly.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-05 ¬∑ Per-item BOM fetch in Consolidated BOM generation</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">N+1 Pattern</span>
          <span class="tag file">BOMBuilder.gs</span>
          <span class="tag file">Lines 855‚Äì869, 1200‚Äì1245</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>buildConsolidatedBOM()</code> loops over all rack item numbers and calls <code>arenaClient.getItemByNumber()</code> per item (line 861), then per rack item fetches its full BOM (line 1245). For a datacenter with 20 racks of 50 items each, this is 20 BOM calls + 1000 item lookups.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Warm the item cache before the loop (one bulk fetch). Use cache for individual lookups inside the loop.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-06 ¬∑ 200ms fixed sleep between paginated requests</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Unnecessary Latency</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Line 589</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The pagination loop in <code>getAllItems()</code> has a hardcoded <code>Utilities.sleep(200)</code> between every page. For a 2000-item catalog this adds 5 √ó 200ms = 1 extra second of unnecessary wait. The delay was added to avoid rate limiting but 200ms is arbitrary.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Remove the fixed sleep. Instead implement reactive backoff only when a 429 is received (see SEC-06). This eliminates ~1s of unnecessary wait during cache warm.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-07 ¬∑ Individual setValue calls for totals row</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Spreadsheet Thrashing</span>
          <span class="tag file">RackPopulator.gs</span>
          <span class="tag file">Lines 166‚Äì170</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Totals row writes use 2 individual <code>setValue()</code> calls then a separate <code>getRange(totalsRow,1,1,4)</code> for formatting. Minor but patterns accumulate.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Use a single <code>setValues([[qty, 'TOTAL ITEMS: '+count, '', '']])</code> call.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-08 ¬∑ BOM template preview fetches 10 items then discards remainder</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Wasted API Work</span>
          <span class="tag file">RackCloneManager.gs</span>
          <span class="tag file">Lines 327‚Äì365</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The template preview function fetches all BOM components but only displays the first 10, discarding the rest. The full BOM is fetched again when the user confirms loading. This doubles the BOM API call for large templates.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Cache the full BOM response from the preview step in <code>CacheService</code> with a short TTL, then reuse it on confirmation instead of re-fetching.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-09 ¬∑ SpreadsheetApp.getActiveSpreadsheet() called multiple times per workflow</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Minor Overhead</span>
          <span class="tag file">Multiple files</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Many functions independently call <code>SpreadsheetApp.getActiveSpreadsheet()</code>. Each call has a small overhead. In functions like <code>buildConsolidatedBOM()</code> this is called 5+ times during the same execution.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Assign the result to a variable at the top of the function and reuse it.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-10 ¬∑ No structured loading progress feedback during template load</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">UX / Perceived Performance</span>
          <span class="tag file">RackCloneManager.gs, RackPicker.html</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>While the actual load time is being fixed, adding progress messaging ("Fetching BOM... Processing 50 components...") would significantly improve the perceived wait time while fixes are implemented.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Use <code>google.script.run</code> status callbacks to update a loading message during each phase of the template load.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">PERF-11 ¬∑ Item cache size not validated before storing</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Cache Reliability</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">Lines 424‚Äì428</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>CacheService has a 100KB per-entry limit. If the item catalog grows beyond ~500 items with full field data, the JSON may exceed the limit. The code does check size but should log a clear warning when approaching the limit.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> If cache size exceeds 95KB, log a prominent warning and consider splitting into multiple cache keys by first letter of item number (e.g., <code>arena_cache_A</code>, <code>arena_cache_B</code>).</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CODE QUALITY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-quality" class="tab-panel">
  <div class="section-title">Code Quality Audit</div>
  <div class="section-desc">Reviewed: Code.gs, Config.gs, DataMapper.gs, SheetManager.gs, LayoutManager.gs, MigrationManager.gs, TypeSystemConfig.gs, FormattingUtils.gs, StatusManager.gs, LegendManager.gs, OverheadManager.gs, CategoryManager.gs, HistoryManager.gs, RackColorManager.gs, RackPicker.html, PODPushWizard.html</div>

  <div class="filter-bar">
    <label>Filter:</label>
    <button class="filter-btn f-all active" onclick="filterFindings('quality','all',this)">All</button>
    <button class="filter-btn f-high"   onclick="filterFindings('quality','high',this)">High</button>
    <button class="filter-btn f-medium" onclick="filterFindings('quality','medium',this)">Medium</button>
    <button class="filter-btn f-low"    onclick="filterFindings('quality','low',this)">Low</button>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-01 ¬∑ Hardcoded sheet name 'Rack History' in trigger</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Hardcoded Value</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Line 134</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>if (sheet.getName() === 'Rack History')</code> ‚Äî if anyone renames this sheet the auto-sidebar feature silently stops working with no error message.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Reference <code>SHEET_NAMES.HISTORY</code> from Config.gs, or add a fallback check and log.</div>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-02 ¬∑ Inconsistent error handling patterns across files</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Error Handling</span>
          <span class="tag file">DataMapper.gs, MigrationManager.gs, SheetManager.gs, multiple</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Four different error patterns are mixed across the codebase: (1) return <code>null</code>, (2) return <code>'UNKNOWN'</code>, (3) throw Error, (4) return <code>{success, error}</code> object. Callers cannot write consistent handling logic.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Standardise on the <code>{success, data, error}</code> pattern already used in MigrationManager, or adopt consistent throw-on-error for internal functions and result-objects only at UI boundaries.</div>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-03 ¬∑ HTML constructed as strings in backend .gs files</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Code Architecture / Security</span>
          <span class="tag file">MigrationManager.gs</span>
          <span class="tag file">Lines 300‚Äì317</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Lines 352‚Äì357</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>HTML markup is constructed via string concatenation inside .gs files. This is error-prone, doesn't benefit from IDE HTML support, and mixes concerns. It also creates the injection risk noted in SEC-03.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Move all HTML to dedicated .html template files (consistent with how RackPicker and PODPushWizard are done). Pass data as JSON via template scriptlets.</div>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-04 ¬∑ Missing try/catch in createSheetBackup</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Missing Error Handling</span>
          <span class="tag file">SheetManager.gs</span>
          <span class="tag file">Line 301</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>spreadsheet.copy(backupName)</code> can fail due to Google Drive quota, permissions errors, or name conflicts. There is no try/catch ‚Äî the exception bubbles up as an unhandled error.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Wrap in try/catch and return a <code>{success: false, error: e.message}</code> to the caller.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-05 ¬∑ onOpen() is 105 lines ‚Äî too many responsibilities</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Function Length</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Lines 18‚Äì123</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>onOpen()</code> handles menu creation, terminology loading, migration detection, and setup wizard display in a single 105-line function. Hard to test and reason about.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Extract sub-functions: <code>buildMainMenu(ui)</code>, <code>checkMigrationNeeded()</code>, <code>showSetupIfNeeded()</code>. Keep onOpen() as a 5-line orchestrator.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-06 ¬∑ Duplicate item field extraction logic</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Duplicate Logic</span>
          <span class="tag file">DataMapper.gs</span>
          <span class="tag file">Lines 31‚Äì68</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>extractItemNumber()</code>, <code>extractItemName()</code>, and <code>extractQuantity()</code> all use the same pattern: try field A, then B, then C, return default. Three nearly-identical functions.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Generalise to a single function.</div>
      <pre>function extractField(item, candidates, defaultVal) {
  for (var i = 0; i &lt; candidates.length; i++) {
    if (item[candidates[i]] != null) return item[candidates[i]];
  }
  return defaultVal;
}
// Usage:
var number = extractField(item, ['number','Number','item_number'], 'UNKNOWN');</pre>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-07 ¬∑ PropertiesService key strings scattered across files</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Hardcoded Value / Single Source of Truth</span>
          <span class="tag file">CategoryManager.gs L7‚Äì10, StatusManager.gs, TypeSystemConfig.gs</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Property keys like <code>'CATEGORY_COLORS'</code>, <code>'BOM_HIERARCHY'</code>, <code>'ITEM_COLUMNS'</code> are defined as string literals in multiple files. A typo in any one causes silent data loss.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Create a <code>PROP_KEYS</code> object in Config.gs and import from there.</div>
      <pre>// Config.gs
var PROP_KEYS = {
  CATEGORY_COLORS:  'CATEGORY_COLORS',
  BOM_HIERARCHY:    'BOM_HIERARCHY',
  ITEM_COLUMNS:     'ITEM_COLUMNS',
  ARENA_EMAIL:      'ARENA_EMAIL',
  ARENA_PASSWORD:   'ARENA_PASSWORD'
};</pre>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-08 ¬∑ Magic number 21600 (6 hours) not named</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Magic Number</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Line 147</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>cache.put('history_sidebar_shown', 'true', 21600)</code> ‚Äî the magic number 21600 means 6 hours but is not obvious to readers.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> <code>var CACHE_6H = 6 * 60 * 60; // 6 hours</code> ‚Äî defined once in Config.gs and reused everywhere.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-09 ¬∑ Weak equality operators (== vs ===)</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Code Quality</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Line 377 + multiple</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>if (response == ui.Button.YES)</code> uses loose equality. While it works here, it's inconsistent with JavaScript best practices and could cause subtle bugs if types differ.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Use strict equality <code>===</code> consistently throughout the codebase.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-10 ¬∑ Column widths hardcoded in 3+ locations</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Hardcoded Value / Duplication</span>
          <span class="tag file">LayoutManager.gs</span>
          <span class="tag file">Lines 53, 154, 222‚Äì228</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Column widths (80px, 120px) are hardcoded in <code>createTowerLayout</code>, <code>createRackConfigSheet</code>, and <code>createOverviewLayout</code>. Changing them requires updating 3 separate files.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add to Config.gs: <code>var COLUMN_WIDTHS = { position: 80, item: 120, category: 150 };</code></div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-11 ¬∑ Silent failure in onEdit trigger</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">Silent Failure</span>
          <span class="tag file">Code.gs</span>
          <span class="tag file">Lines 194‚Äì197</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The <code>onEdit</code> catch block silently logs and swallows errors. Users have no way of knowing their edit triggered an error (e.g., a status update failed).</p>
      <pre>catch (error) {
  // Silent failure - don't interrupt user's editing experience
  Logger.log('Error in onEdit trigger: ' + error.message);
}</pre>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Write errors to the History tab using <code>logToHistory()</code>, or show a brief toast via <code>SpreadsheetApp.getActiveSpreadsheet().toast()</code>.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-12 ¬∑ Deprecated wrapper functions not removed</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Dead Code</span>
          <span class="tag file">Config.gs L246‚Äì248, DataMapper.gs L161‚Äì163</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Functions like <code>determineRackType()</code> are marked DEPRECATED and simply call their replacement. They add noise and surface area without value.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Search for callers with grep. If zero callers exist, delete the wrappers. If callers exist, update them.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-13 ¬∑ Regex pattern unexplained in RackColorManager</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Code Clarity</span>
          <span class="tag file">RackColorManager.gs</span>
          <span class="tag file">Line 169</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>/(\d{3}-\d{4})/</code> matches an item number format but has no comment explaining the format it targets.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> <code>var ITEM_NUM_RE = /(\d{3}-\d{4})/; // Arena item format e.g. "123-4567"</code></div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-14 ¬∑ Missing array/type validation before iteration</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Missing Validation</span>
          <span class="tag file">Config.gs L183‚Äì193, DataMapper.gs L129‚Äì131</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Several loops assume the variable being iterated is an array without checking first. If the backing data has an unexpected structure, a cryptic <code>TypeError</code> is thrown.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> <code>if (!Array.isArray(keywords)) return null;</code> guard before iteration.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">QA-15 ¬∑ History event types lack inline documentation</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Documentation</span>
          <span class="tag file">HistoryManager.gs</span>
          <span class="tag file">Lines 33‚Äì50</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Events like <code>RACK_CREATED</code>, <code>RACK_CLONED</code>, <code>TEMPLATE_LOADED</code> have no comments explaining when each fires, creating confusion about which to use in new code.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add one-line JSDoc per event type describing the trigger condition.</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ARENA API / UX ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-arena" class="tab-panel">
  <div class="section-title">Arena API Compliance &amp; UX Review</div>
  <div class="section-desc">Reviewed against: Arena API codingAssistance rules, AI_AGENT_QUICK_REFERENCE.md, Arena REST API v1 spec. Implementation files: ArenaAPI.gs, BOMBuilder.gs, BOMRefresh.gs, BOMConfiguration.gs, RackConfigManager.gs, RackPopulator.gs, SetupWizard_Backend.gs. UI files: ItemPicker.html, RackPicker.html, BOMTreeModal.html, PODPushWizard.html, SetupWizard.html, LoginWizard.html.</div>

  <div class="filter-bar">
    <label>Filter:</label>
    <button class="filter-btn f-all active" onclick="filterFindings('arena','all',this)">All</button>
    <button class="filter-btn f-critical" onclick="filterFindings('arena','critical',this)">Critical</button>
    <button class="filter-btn f-high"     onclick="filterFindings('arena','high',this)">High</button>
    <button class="filter-btn f-medium"   onclick="filterFindings('arena','medium',this)">Medium</button>
    <button class="filter-btn f-low"      onclick="filterFindings('arena','low',this)">Low</button>
  </div>

  <!-- ARENA API FINDINGS -->
  <div class="finding" data-sev="critical">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API-01 ¬∑ Missing DomainApi layer ‚Äî guidance mandates 3-layer architecture</div>
        <div class="finding-meta">
          <span class="tag sev-critical">Critical</span>
          <span class="tag cat">Architecture Non-Compliance</span>
          <span class="tag file">ArenaAPI.gs</span>
          <span class="tag file">BOMBuilder.gs, RackConfigManager.gs</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The Arena API coding guidance mandates a three-layer architecture: <strong>SessionManager ‚Üí ApiClient ‚Üí DomainApi</strong>. The current codebase has only two layers: session management is mixed into ArenaAPIClient, and user code (BOMBuilder, RackConfigManager) calls <code>ArenaAPIClient.makeRequest()</code> directly ‚Äî bypassing the Domain layer entirely. This means business logic is scattered across files rather than centralised in domain-specific API classes.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Create domain-specific API wrappers: <code>ItemsApi</code>, <code>BOMApi</code>, <code>CategoriesApi</code>. User code calls <code>ItemsApi.get(number)</code> not <code>client.makeRequest('/items/...')</code> directly. This also enables better error messages, caching, and validation at the domain layer.</div>
      <pre>// Future: ItemsApi.gs
var ItemsApi = {
  get: function(itemNumber) {
    // Validation, caching, error mapping here
    return getArenaClient().makeRequest('/items/' + encodeURIComponent(itemNumber));
  },
  getBOM: function(itemGuid) {
    return getArenaClient().makeRequest('/items/' + itemGuid + '/bom');
  }
};</pre>
    </div>
  </div>

  <div class="finding" data-sev="critical">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API-02 ¬∑ Multiple ArenaAPIClient instances per workflow ‚Äî session management pattern violation</div>
        <div class="finding-meta">
          <span class="tag sev-critical">Critical</span>
          <span class="tag cat">Session Management Non-Compliance</span>
          <span class="tag file">BOMBuilder.gs L57‚Äì60, L228</span>
          <span class="tag file">BOMRefresh.gs L96</span>
          <span class="tag file">RackConfigManager.gs L84</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The guidance states: "Create SessionManager ONCE per workflow." Currently, each major function creates <code>new ArenaAPIClient()</code> independently. For a multi-step BOM push workflow, this creates 3‚Äì4 separate client instances, each calling <code>getValidSessionId()</code>. While CacheService prevents full re-logins, this violates the documented pattern and creates edge-case risks.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Implement a singleton <code>getArenaClient()</code> getter that creates one shared instance per script execution, or pass the client instance through the call chain for multi-step workflows.</div>
      <pre>// ArenaAPI.gs ‚Äî add singleton getter
var _arenaClientInstance = null;
function getArenaClient() {
  if (!_arenaClientInstance) {
    _arenaClientInstance = new ArenaAPIClient();
  }
  return _arenaClientInstance;
}</pre>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API-03 ¬∑ No metadata-first validation before CREATE/UPDATE operations</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">API Best Practice Non-Compliance</span>
          <span class="tag file">BOMBuilder.gs</span>
          <span class="tag file">Lines 250‚Äì253</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The Arena API guidance (Example 3) explicitly mandates: fetch metadata ‚Üí validate fields ‚Üí only then create/update. Currently, item creation passes category and fields directly to the API without first validating that the category exists or that required fields are present. Result: users see raw Arena API error messages like "HTTP 400: The value for attribute 'category' is not valid."</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Before creating/updating items, call <code>/settings/categories</code> and validate the category exists. Map errors to user-friendly messages before displaying them.</div>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API-04 ¬∑ Inconsistent response field name normalisation</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Arena API Field Casing</span>
          <span class="tag file">ArenaAPI.gs, BOMBuilder.gs, BOMRefresh.gs</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>The Arena API guidance flags: "Response field casing is inconsistent ‚Äî sometimes <code>results</code>, sometimes <code>Results</code>." The codebase handles this sporadically: some code uses <code>response.results || response.Results</code>, other code only checks one case, potentially missing data on some endpoints.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add a normalisation helper used everywhere.</div>
      <pre>function extractResults(response) {
  return response.results || response.Results ||
         response.items   || response.Items   ||
         (Array.isArray(response) ? response : []);
}</pre>
    </div>
  </div>

  <div class="finding" data-sev="high">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API-05 ¬∑ Pagination not implemented for all list endpoints</div>
        <div class="finding-meta">
          <span class="tag sev-high">High</span>
          <span class="tag cat">Missing Pagination</span>
          <span class="tag file">BOMConfiguration.gs</span>
          <span class="tag file">Line 95</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p><code>getBOMAttributes()</code> fetches <code>/settings/items/bom/attributes</code> without pagination. If an Arena workspace has more than 400 BOM attributes configured, the results will be silently truncated. The pagination loop in <code>getAllItems()</code> is correct ‚Äî the same pattern needs to be applied to settings endpoints.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Apply the same <code>offset/limit</code> pagination loop to all <code>/settings/*</code> list endpoints. Max limit per page is 400 per the Arena API spec.</div>
    </div>
  </div>

  <!-- UX findings -->
  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-01 ¬∑ No loading state during long API operations</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî No Loading State</span>
          <span class="tag file">ItemPicker.html, RackPicker.html, BOMTreeModal.html</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Operations like "Refresh BOM", "Load Template", and "Fetch Items" can take 5‚Äì30 seconds. During this time the UI shows no spinner, no progress indicator, and buttons remain active. Users perceive the tool as frozen and may click multiple times triggering duplicate operations.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Immediately disable action buttons and show a spinner when a long operation starts. Update with progress messages via a hidden status div. Restore UI state on completion or error.</div>
      <pre>// Example pattern for any async button
btn.disabled = true;
statusDiv.textContent = 'Fetching items from Arena...';
spinner.style.display = 'block';
google.script.run
  .withSuccessHandler(function(data) {
    spinner.style.display = 'none';
    btn.disabled = false;
    renderResults(data);
  })
  .withFailureHandler(function(err) {
    spinner.style.display = 'none';
    btn.disabled = false;
    statusDiv.textContent = 'Error: ' + err.message;
  })
  .fetchArenaItems();</pre>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-02 ¬∑ Destructive BOM clear has no confirmation dialog</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî No Confirmation</span>
          <span class="tag file">BOMBuilder.gs</span>
          <span class="tag file">Lines 84‚Äì86</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>When pulling a BOM, existing sheet content is cleared without warning the user. Users who have manually added notes or customisations to BOM rows will lose their work silently.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Before clearing, check if the sheet has data and prompt the user: "This will replace {N} existing rows. Continue?"</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-03 ¬∑ Raw API error messages surfaced to users</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî Error Messages</span>
          <span class="tag file">BOMBuilder.gs L284, RackConfigManager.gs L111</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>API errors are re-thrown without translation: users see "HTTP 400: The value for attribute 'category' is not valid" instead of actionable guidance. This is particularly problematic during POD push operations where errors may block completion.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Build an error translation layer that maps known Arena API error patterns to user-friendly messages with suggested actions.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-04 ¬∑ Empty state not handled in ItemPicker results list</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî Empty States</span>
          <span class="tag file">ItemPicker.html</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>When a search returns 0 results or the item cache is empty, the results area is blank. Users cannot tell if: (a) the search genuinely has no matches, (b) the cache hasn't loaded yet, or (c) there's an error.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Display contextual empty state messages: "No items found ‚Äî try a different search term" vs "Cache loading‚Ä¶" vs "Cache is empty ‚Äî click Refresh to load items from Arena."</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-05 ¬∑ Missing item number input validation in RackConfigManager</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî Input Validation</span>
          <span class="tag file">RackConfigManager.gs</span>
          <span class="tag file">Lines 76‚Äì78, 128‚Äì130</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Item number inputs are only checked for empty string. Special characters, excessive length, and invalid formats are passed directly to Arena causing confusing API errors.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Validate format with a regex and length check before sending to Arena. Surface a clear validation message immediately.</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-06 ¬∑ Configuration modals have no help text or tooltips</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî Accessibility</span>
          <span class="tag file">ConfigureBOMPositionAttribute.html, ConfigureColumns.html</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Complex configuration dialogs (BOM attributes, column configuration) have no help text, tooltips, or examples. Users who are not Arena power-users don't understand the difference between "BOM Attribute" and "Item Attribute", or what "Position Format" means.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add a tooltip (?) icon next to each complex field with an explanatory tooltip or link to docs. Add inline examples: "e.g., 'Pos {n}' ‚Üí 'Pos 1', 'Pos 2'".</div>
    </div>
  </div>

  <div class="finding" data-sev="medium">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-07 ¬∑ Keyboard navigation not supported in modal dialogs</div>
        <div class="finding-meta">
          <span class="tag sev-medium">Medium</span>
          <span class="tag cat">UX ‚Äî Accessibility</span>
          <span class="tag file">ItemPicker.html, RackPicker.html</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Modal dialogs cannot be dismissed with Escape, submitted with Enter, or navigated with Tab in a logical order. Users who rely on keyboard navigation are blocked.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Add <code>keydown</code> listener: Enter submits, Escape closes. Add explicit <code>tabindex</code> attributes to put focus in logical order.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">UX-08 ¬∑ Hardcoded hierarchy names "POD", "Row", "Rack" bypassing dynamic system</div>
        <div class="finding-meta">
          <span class="tag sev-low">Low</span>
          <span class="tag cat">Hardcoding / Localisation</span>
          <span class="tag file">BOMBuilder.gs</span>
          <span class="tag file">Lines 5‚Äì18</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <h4>Description</h4>
      <p>Many code paths reference "POD", "Row", "Rack" as literal strings even though a dynamic hierarchy naming system exists (<code>getHierarchyLevelName()</code>). Users who rename levels (e.g., to "Building/Floor/Cabinet") see broken labels.</p>
      <h4>Recommendation</h4>
      <div class="rec-box"><strong>Fix:</strong> Replace all hardcoded hierarchy names with calls to <code>getHierarchyLevelName(level)</code> consistently.</div>
    </div>
  </div>

  <div class="finding" data-sev="low">
    <div class="finding-header" onclick="toggleFinding(this)">
      <div>
        <div class="finding-title">API ‚úì ¬∑ Confirmed good Arena API practices</div>
        <div class="finding-meta">
          <span class="tag sev-info">Info</span>
          <span class="tag cat">Positive Findings</span>
        </div>
      </div>
      <span class="arrow">‚ñ∂</span>
    </div>
    <div class="finding-body">
      <ul style="padding-left:16px;margin-top:10px;">
        <li style="margin-bottom:6px;">‚úì "Login Once, Reuse Session" pattern correctly implemented</li>
        <li style="margin-bottom:6px;">‚úì 6-hour CacheService TTL for session token is well-chosen</li>
        <li style="margin-bottom:6px;">‚úì Automatic re-auth on 401 responses is implemented</li>
        <li style="margin-bottom:6px;">‚úì Item cache shared across features prevents duplicate catalog fetches</li>
        <li style="margin-bottom:6px;">‚úì Offset-based pagination correctly implemented in <code>getAllItems()</code></li>
        <li style="margin-bottom:6px;">‚úì <code>response.results || response.Results</code> pattern used in most places</li>
      </ul>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROADMAP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="tab-roadmap" class="tab-panel">
  <div class="section-title">Priority Roadmap</div>
  <div class="section-desc">Recommended implementation order based on impact/effort ratio. Estimated effort in parentheses.</div>

  <div class="roadmap">
    <h3>Implementation Phases</h3>
    <div class="roadmap-phases">

      <div class="phase p1">
        <h4>üî¥ Phase 1 ‚Äî Fix Now (High Impact)</h4>
        <ul>
          <li><strong>PERF-01</strong> ‚Äî Fix N+1 API loop in BOMRefresh using item cache. <em>Primary cause of 10s load times.</em></li>
          <li><strong>PERF-02</strong> ‚Äî Batch row colour formatting in RackPopulator using setBackgrounds()/setFontColors()</li>
          <li><strong>API-02</strong> ‚Äî Implement singleton <code>getArenaClient()</code> to avoid multiple instances</li>
          <li><strong>SEC-06</strong> ‚Äî Add 429 rate-limit handler with Retry-After backoff</li>
          <li><strong>SEC-03</strong> ‚Äî Escape HTML in showProgressDialog</li>
          <li><strong>QA-02</strong> ‚Äî Standardise error handling to {success, data, error} pattern</li>
        </ul>
      </div>

      <div class="phase p2">
        <h4>üü† Phase 2 ‚Äî Short Term (Quality &amp; UX)</h4>
        <ul>
          <li><strong>PERF-03</strong> ‚Äî Batch metadata cell writes in RackConfigManager</li>
          <li><strong>PERF-06</strong> ‚Äî Remove fixed 200ms sleep, replace with reactive backoff</li>
          <li><strong>UX-01</strong> ‚Äî Add loading spinners and progress messages to all long operations</li>
          <li><strong>UX-02</strong> ‚Äî Add confirmation dialogs before destructive BOM clears</li>
          <li><strong>UX-03</strong> ‚Äî Translate Arena API errors to user-friendly messages</li>
          <li><strong>UX-04</strong> ‚Äî Add empty state messages in ItemPicker</li>
          <li><strong>QA-07</strong> ‚Äî Centralise PropertiesService keys in Config.gs PROP_KEYS object</li>
          <li><strong>QA-01</strong> ‚Äî Replace hardcoded 'Rack History' string with CONFIG constant</li>
          <li><strong>SEC-01</strong> ‚Äî Add DEBUG_MODE flag, filter sensitive data from production logs</li>
          <li><strong>API-04</strong> ‚Äî Implement <code>extractResults()</code> normalisation helper</li>
        </ul>
      </div>

      <div class="phase p3">
        <h4>üü¢ Phase 3 ‚Äî Long Term (Architecture)</h4>
        <ul>
          <li><strong>API-01</strong> ‚Äî Refactor to 3-layer architecture with DomainApi classes (ItemsApi, BOMApi, CategoriesApi)</li>
          <li><strong>API-03</strong> ‚Äî Implement metadata-first validation for all CREATE/UPDATE operations</li>
          <li><strong>API-05</strong> ‚Äî Add pagination to /settings/* list endpoints</li>
          <li><strong>UX-06</strong> ‚Äî Add tooltips and help text to configuration modals</li>
          <li><strong>UX-07</strong> ‚Äî Add keyboard navigation to all modal dialogs</li>
          <li><strong>QA-03</strong> ‚Äî Move HTML string templates to external .html files</li>
          <li><strong>QA-06</strong> ‚Äî Refactor extractItemNumber/Name/Quantity to generic extractField()</li>
          <li><strong>QA-05</strong> ‚Äî Break onOpen() into smaller focused functions</li>
          <li><strong>SEC-02</strong> ‚Äî Evaluate OAuth2 for Arena if available; add service account documentation</li>
          <li><strong>UX-08</strong> ‚Äî Replace all hardcoded "POD/Row/Rack" with dynamic hierarchy names</li>
        </ul>
      </div>

    </div>
  </div>

  <!-- files hotspot -->
  <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:24px;margin-top:24px;">
    <h3 style="font-size:16px;font-weight:700;margin-bottom:16px;">Files with Highest Finding Concentration</h3>
    <table style="width:100%;border-collapse:collapse;font-size:13px;">
      <thead>
        <tr style="background:#f8fafc;border-bottom:2px solid var(--border);">
          <th style="text-align:left;padding:10px 12px;">File</th>
          <th style="text-align:center;padding:10px;">Critical</th>
          <th style="text-align:center;padding:10px;">High</th>
          <th style="text-align:center;padding:10px;">Medium</th>
          <th style="text-align:center;padding:10px;">Low</th>
          <th style="text-align:center;padding:10px;">Total</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">Code.gs</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">3</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">5</td>
          <td style="text-align:center;padding:10px;color:var(--low);">4</td>
          <td style="text-align:center;padding:10px;font-weight:700;">12</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);background:#fafafa;">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">ArenaAPI.gs</td>
          <td style="text-align:center;padding:10px;color:var(--critical);font-weight:700;">2</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">2</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">2</td>
          <td style="text-align:center;padding:10px;color:var(--low);">4</td>
          <td style="text-align:center;padding:10px;font-weight:700;">10</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">BOMBuilder.gs</td>
          <td style="text-align:center;padding:10px;color:var(--critical);font-weight:700;">1</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">2</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">3</td>
          <td style="text-align:center;padding:10px;color:var(--low);">1</td>
          <td style="text-align:center;padding:10px;font-weight:700;">7</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);background:#fafafa;">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">BOMRefresh.gs</td>
          <td style="text-align:center;padding:10px;color:var(--critical);font-weight:700;">1</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">1</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">1</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;font-weight:700;">3</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">RackConfigManager.gs</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">2</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">3</td>
          <td style="text-align:center;padding:10px;color:var(--low);">1</td>
          <td style="text-align:center;padding:10px;font-weight:700;">6</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);background:#fafafa;">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">RackPopulator.gs</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">2</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">2</td>
          <td style="text-align:center;padding:10px;color:var(--low);">1</td>
          <td style="text-align:center;padding:10px;font-weight:700;">5</td>
        </tr>
        <tr style="border-bottom:1px solid var(--border);">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">Config.gs</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;color:var(--high);font-weight:700;">1</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">3</td>
          <td style="text-align:center;padding:10px;color:var(--low);">3</td>
          <td style="text-align:center;padding:10px;font-weight:700;">7</td>
        </tr>
        <tr style="background:#fafafa;">
          <td style="padding:10px 12px;font-family:monospace;color:#3b82f6;">LayoutManager.gs, DataMapper.gs, MigrationManager.gs</td>
          <td style="text-align:center;padding:10px;">‚Äî</td>
          <td style="text-align:center;padding:10px;color:var(--high);">1 ea.</td>
          <td style="text-align:center;padding:10px;color:var(--medium);">2‚Äì3 ea.</td>
          <td style="text-align:center;padding:10px;color:var(--low);">1‚Äì2 ea.</td>
          <td style="text-align:center;padding:10px;font-weight:700;">4‚Äì5 ea.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

</div><!-- end content -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="report-footer">
  <p>Generated: February 25, 2026 ¬∑ PTC Arena Sheets DataCenter Code Review ¬∑ 4-agent automated review (Security ¬∑ Performance ¬∑ Code Quality ¬∑ Arena API/UX) ¬∑ Claude Code</p>
</div>

<script>
  // ‚îÄ‚îÄ Tab switching ‚îÄ‚îÄ
  function switchTab(name) {
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + name).classList.add('active');
    event.currentTarget.classList.add('active');
  }

  // ‚îÄ‚îÄ Accordion ‚îÄ‚îÄ
  function toggleFinding(header) {
    var card = header.parentElement;
    card.classList.toggle('open');
  }

  // ‚îÄ‚îÄ Filter by severity ‚îÄ‚îÄ
  function filterFindings(tab, sev, btn) {
    btn.closest('.filter-bar').querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    var panel = document.getElementById('tab-' + tab);
    panel.querySelectorAll('.finding').forEach(function(f) {
      if (sev === 'all' || f.dataset.sev === sev) {
        f.style.display = '';
      } else {
        f.style.display = 'none';
      }
    });
  }

  // Open first finding in each tab by default
  document.querySelectorAll('.tab-panel').forEach(function(panel) {
    var first = panel.querySelector('.finding');
    if (first) first.classList.add('open');
  });
</script>
</body>
</html>
